- name: Install and configure eWaterCycle Jupyter
  hosts:
    - localhost
  gather_facts: false
  tasks:
    - name: Wait for system to become reachable
      wait_for_connection:
        timeout: 300

    - name: Gather facts for first time
      setup:

    # Container engines
    - name: Docker
      include_role:
        name: docker
    - name: singularity
      include_role:
        name: singularity

    - name: Install conda
      include_role:
        name: conda
      vars:
        conda_tarball_root: /opt
        conda_root: /opt/conda

    # TODO mount climate disk
    # TODO mount parameter set disk
    # TODO mount scratch disk
    # TODO mount persistent home disk

    # TODO configure roles so they work on research cloud

    # https://lab.ewatercycle.org/ functionality
    # - include_role:
    #     name: labstart  # TODO use already present nginx

    # https://explore.ewatercycle.org/ functionality
    # - include_role:
    #     name: launcher
    # - include_role:
    #     name: terria

    # https://jupyter.ewatercycle.org/ functionality
    # - name: Create eWaterCycle conda env
    #   include_role:
    #     name: ewatercycle
    # - name: Set up Jupyter lab/hub
    #   include_role:
    #     name: jupyter ## TODO reaplce partly with https://gitlab.com/rsc-surf-nl/rsc-plugins/-/blob/master/ansible/application-jupyter/application-jupyter.yml
    # - name: grdc
    #   include_role:
    #     name: grdc

    - debug:
        msg: The eWaterCycle Jupyter plugin has completed
